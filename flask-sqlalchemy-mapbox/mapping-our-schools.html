<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Mapping our schools | Building Python-based, database-driven web applications (with maps!) using Flask, SQLite, SQLAlchemy and MapBox</title>
  <meta name="description" content="A guide to building a simple database-based web application with Flask and SQLAlchemy, along with a little MapBox mapping thrown in for good measure." />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Mapping our schools | Building Python-based, database-driven web applications (with maps!) using Flask, SQLite, SQLAlchemy and MapBox" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to building a simple database-based web application with Flask and SQLAlchemy, along with a little MapBox mapping thrown in for good measure." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Mapping our schools | Building Python-based, database-driven web applications (with maps!) using Flask, SQLite, SQLAlchemy and MapBox" />
  
  <meta name="twitter:description" content="A guide to building a simple database-based web application with Flask and SQLAlchemy, along with a little MapBox mapping thrown in for good measure." />
  

<meta name="author" content="Jonathan Soma" />


<meta name="date" content="2019-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="layouts-for-our-templates.html">
<link rel="next" href="reorganizing-our-page-with-columns.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style.replace(/;/g, ' !important;') + '}', j);
    }
  }
})();
</script>
<style>
.sourceCode.python {
  margin-bottom: 0 !important;
}

.book .book-body .page-wrapper .page-inner section.normal .sourceCode.python + p {
  margin-top: 1.275em;
}

.book .book-body .page-wrapper .page-inner section.normal .sourceCode.python + table {
  margin-top: 1.275em !important;
}

.book .book-body .page-wrapper .page-inner section.normal pre > code {
  word-wrap: break-word;
  white-space: pre-wrap;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#our-goal"><i class="fa fa-check"></i><b>1.1</b> Our goal</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#every-step-well-take"><i class="fa fa-check"></i><b>1.2</b> Every step we’ll take</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-in-the-name-of-undiscovered-species-am-i-doing-this"><i class="fa fa-check"></i><b>1.3</b> Why in the name of undiscovered species am I doing this?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html"><i class="fa fa-check"></i><b>2</b> Getting started with Flask</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#babys-first-web-app"><i class="fa fa-check"></i><b>2.1</b> Baby’s first web app</a><ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#servers-up-servers-down"><i class="fa fa-check"></i><b>2.1.1</b> Servers up servers down</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#routing-in-flask"><i class="fa fa-check"></i><b>2.1.2</b> Routing in Flask</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#here-we-go-again"><i class="fa fa-check"></i><b>2.1.3</b> Here we go again</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#template-time"><i class="fa fa-check"></i><b>2.2</b> Template time</a><ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#bringing-structure-to-this-world"><i class="fa fa-check"></i><b>2.2.1</b> Bringing structure to this world</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#template-time-1"><i class="fa fa-check"></i><b>2.2.2</b> Template time</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#adding-css"><i class="fa fa-check"></i><b>2.3</b> Adding CSS</a><ul>
<li class="chapter" data-level="2.3.1" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#hello-bootstrap"><i class="fa fa-check"></i><b>2.3.1</b> Hello Bootstrap!</a></li>
<li class="chapter" data-level="2.3.2" data-path="getting-started-with-flask.html"><a href="getting-started-with-flask.html#what-now"><i class="fa fa-check"></i><b>2.3.2</b> What now?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setting-up-our-database.html"><a href="setting-up-our-database.html"><i class="fa fa-check"></i><b>3</b> Setting up our database</a><ul>
<li class="chapter" data-level="3.1" data-path="setting-up-our-database.html"><a href="setting-up-our-database.html#intro-to-sqlite"><i class="fa fa-check"></i><b>3.1</b> Intro to SQLite</a></li>
<li class="chapter" data-level="3.2" data-path="setting-up-our-database.html"><a href="setting-up-our-database.html#creating-a-new-sqlite-database"><i class="fa fa-check"></i><b>3.2</b> Creating a new SQLite database</a><ul>
<li class="chapter" data-level="3.2.1" data-path="setting-up-our-database.html"><a href="setting-up-our-database.html#double-checking-the-import"><i class="fa fa-check"></i><b>3.2.1</b> Double-checking the import</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html"><i class="fa fa-check"></i><b>4</b> Connecting Flask to SQLite</a><ul>
<li class="chapter" data-level="4.1" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html#speaking-sql"><i class="fa fa-check"></i><b>4.1</b> Speaking SQL</a></li>
<li class="chapter" data-level="4.2" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html#introduction-to-orms"><i class="fa fa-check"></i><b>4.2</b> Introduction to ORMs</a><ul>
<li class="chapter" data-level="4.2.1" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html#setting-up-sqlalchemy"><i class="fa fa-check"></i><b>4.2.1</b> Setting up SQLAlchemy</a></li>
<li class="chapter" data-level="4.2.2" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html#adding-our-model"><i class="fa fa-check"></i><b>4.2.2</b> Adding our Model</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html#using-sqlalchemy"><i class="fa fa-check"></i><b>4.3</b> Using SQLAlchemy</a><ul>
<li class="chapter" data-level="4.3.0.1" data-path="connecting-flask-to-sqlite.html"><a href="connecting-flask-to-sqlite.html#ready-to-go"><i class="fa fa-check"></i><b>4.3.0.1</b> Ready to go?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html"><i class="fa fa-check"></i><b>5</b> Putting data on the page</a><ul>
<li class="chapter" data-level="5.1" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#sending-data-to-the-template"><i class="fa fa-check"></i><b>5.1</b> Sending data to the template</a></li>
<li class="chapter" data-level="5.2" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#hello-jinja2"><i class="fa fa-check"></i><b>5.2</b> Hello Jinja2</a></li>
<li class="chapter" data-level="5.3" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#sending-meaningful-data-to-the-template"><i class="fa fa-check"></i><b>5.3</b> Sending meaningful data to the template</a><ul>
<li class="chapter" data-level="5.3.1" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#formatting-your-numbers"><i class="fa fa-check"></i><b>5.3.1</b> Formatting your numbers</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#sending-lists-to-our-template"><i class="fa fa-check"></i><b>5.4</b> Sending lists to our template</a></li>
<li class="chapter" data-level="5.5" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#making-school-pages"><i class="fa fa-check"></i><b>5.5</b> Making school pages</a><ul>
<li class="chapter" data-level="5.5.1" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#slugs"><i class="fa fa-check"></i><b>5.5.1</b> Slugs</a></li>
<li class="chapter" data-level="5.5.2" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#building-our-detail-route"><i class="fa fa-check"></i><b>5.5.2</b> Building our detail route</a></li>
<li class="chapter" data-level="5.5.3" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#crafting-a-detail-page"><i class="fa fa-check"></i><b>5.5.3</b> Crafting a detail page</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#linking-from-the-index-to-the-detail-page"><i class="fa fa-check"></i><b>5.6</b> Linking from the index to the detail page</a></li>
<li class="chapter" data-level="5.7" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#reusing-templates"><i class="fa fa-check"></i><b>5.7</b> Reusing templates</a><ul>
<li class="chapter" data-level="5.7.1" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#adding-yet-another-route"><i class="fa fa-check"></i><b>5.7.1</b> Adding yet another route</a></li>
<li class="chapter" data-level="5.7.2" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#fixing-up-the-root-route"><i class="fa fa-check"></i><b>5.7.2</b> Fixing up the root route</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#cleaning-up"><i class="fa fa-check"></i><b>5.8</b> Cleaning up</a><ul>
<li class="chapter" data-level="5.8.1" data-path="putting-data-on-the-page.html"><a href="putting-data-on-the-page.html#our-code"><i class="fa fa-check"></i><b>5.8.1</b> Our code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="leveling-up-with-advanced-sqlalchemy-queries.html"><a href="leveling-up-with-advanced-sqlalchemy-queries.html"><i class="fa fa-check"></i><b>6</b> Leveling up with advanced SQLAlchemy queries</a><ul>
<li class="chapter" data-level="6.1" data-path="leveling-up-with-advanced-sqlalchemy-queries.html"><a href="leveling-up-with-advanced-sqlalchemy-queries.html#listing-all-of-our-cities"><i class="fa fa-check"></i><b>6.1</b> Listing all of our cities</a><ul>
<li class="chapter" data-level="6.1.1" data-path="leveling-up-with-advanced-sqlalchemy-queries.html"><a href="leveling-up-with-advanced-sqlalchemy-queries.html#cleaning-text-in-our-jinja2-templates"><i class="fa fa-check"></i><b>6.1.1</b> Cleaning text in our Jinja2 templates</a></li>
<li class="chapter" data-level="6.1.2" data-path="leveling-up-with-advanced-sqlalchemy-queries.html"><a href="leveling-up-with-advanced-sqlalchemy-queries.html#no-wait-maybe-not"><i class="fa fa-check"></i><b>6.1.2</b> No wait, maybe not!</a></li>
<li class="chapter" data-level="6.1.3" data-path="leveling-up-with-advanced-sqlalchemy-queries.html"><a href="leveling-up-with-advanced-sqlalchemy-queries.html#doing-the-same-for-zip-codes"><i class="fa fa-check"></i><b>6.1.3</b> Doing the same for ZIP codes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="layouts-for-our-templates.html"><a href="layouts-for-our-templates.html"><i class="fa fa-check"></i><b>7</b> Layouts for our templates</a><ul>
<li class="chapter" data-level="7.1" data-path="layouts-for-our-templates.html"><a href="layouts-for-our-templates.html#layouts"><i class="fa fa-check"></i><b>7.1</b> Layouts</a><ul>
<li class="chapter" data-level="7.1.1" data-path="layouts-for-our-templates.html"><a href="layouts-for-our-templates.html#and-a-final-fun-trick"><i class="fa fa-check"></i><b>7.1.1</b> And a final fun trick</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="layouts-for-our-templates.html"><a href="layouts-for-our-templates.html#adding-in-our-navigation"><i class="fa fa-check"></i><b>7.2</b> Adding in our navigation</a><ul>
<li class="chapter" data-level="7.2.1" data-path="layouts-for-our-templates.html"><a href="layouts-for-our-templates.html#a-dropdown-for-cities"><i class="fa fa-check"></i><b>7.2.1</b> A dropdown for cities</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html"><i class="fa fa-check"></i><b>8</b> Mapping our schools</a><ul>
<li class="chapter" data-level="8.1" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html#adding-mapbox-to-our-pages"><i class="fa fa-check"></i><b>8.1</b> Adding MapBox to our pages</a><ul>
<li class="chapter" data-level="8.1.1" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html#adding-mapbox-css-and-js"><i class="fa fa-check"></i><b>8.1.1</b> Adding MapBox CSS and JS</a></li>
<li class="chapter" data-level="8.1.2" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html#adding-a-basic-and-fake-map"><i class="fa fa-check"></i><b>8.1.2</b> Adding a basic (and fake) map</a></li>
<li class="chapter" data-level="8.1.3" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html#inserting-our-data-into-the-map"><i class="fa fa-check"></i><b>8.1.3</b> Inserting our data into the map</a></li>
<li class="chapter" data-level="8.1.4" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html#zooming-and-centering"><i class="fa fa-check"></i><b>8.1.4</b> Zooming and centering</a></li>
<li class="chapter" data-level="8.1.5" data-path="mapping-our-schools.html"><a href="mapping-our-schools.html#adjusting-the-style-of-our-dot"><i class="fa fa-check"></i><b>8.1.5</b> Adjusting the style of our dot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reorganizing-our-page-with-columns.html"><a href="reorganizing-our-page-with-columns.html"><i class="fa fa-check"></i><b>9</b> Reorganizing our page with columns</a><ul>
<li class="chapter" data-level="9.1" data-path="reorganizing-our-page-with-columns.html"><a href="reorganizing-our-page-with-columns.html#columns-and-rows"><i class="fa fa-check"></i><b>9.1</b> Columns and rows</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building Python-based, database-driven web applications (with maps!) using Flask, SQLite, SQLAlchemy and MapBox</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapping-our-schools" class="section level1">
<h1><span class="header-section-number">8</span> Mapping our schools</h1>
<p>We’re going to map our schools with <a href="https://docs.mapbox.com/mapbox-gl-js/overview/">MapBox GL</a>. Once upon a time we would have used <a href="http://leafletjs.com">Leaflet</a>, but the world has since moved on to newer and (arguably) better things.</p>
<div id="adding-mapbox-to-our-pages" class="section level2">
<h2><span class="header-section-number">8.1</span> Adding MapBox to our pages</h2>
<div id="adding-mapbox-css-and-js" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Adding MapBox CSS and JS</h3>
<p>MapBox uses special CSS and JavaScript to work. Since we aren’t sure which pages we’ll be using it on, we might as well just add it to our universal layout.</p>
<p>Edit the <code>&lt;head&gt;</code> section of <code>layout.html</code> to match this:</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;head&gt;</span>
  <span class="kw">&lt;title&gt;</span>{{ self.headline() }}<span class="kw">&lt;/title&gt;</span>
  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css&quot;</span><span class="ot"> crossorigin=</span><span class="st">&quot;anonymous&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js&#39;</span><span class="kw">&gt;&lt;/script&gt;</span>
  <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css&#39;</span><span class="ot"> rel=</span><span class="st">&#39;stylesheet&#39;</span> <span class="kw">/&gt;</span>
<span class="kw">&lt;/head&gt;</span></code></pre>
<p>Now every single page will be able to use the ultimate magic power of MapBox!</p>
</div>
<div id="adding-a-basic-and-fake-map" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Adding a basic (and fake) map</h3>
<p>Now we’ll open up <code>detail.html</code> and add the sample MapBox map from their documentation in the <code>content</code> block.</p>
<pre class="sourceCode html"><code class="sourceCode html">{% block content %}
<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;container&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;map&#39;</span><span class="ot"> style=</span><span class="st">&#39;width: 400px; height: 300px;&#39;</span><span class="kw">&gt;&lt;/div&gt;</span>
  <span class="kw">&lt;script&gt;</span>
  <span class="va">mapboxgl</span>.<span class="at">accessToken</span> <span class="op">=</span> <span class="st">&#39;pk.eyJ1IjoianNvbWEiLCJhIjoibFJmYl9JWSJ9.AUm8d76cbOvVEn2mMeG_ZA&#39;</span><span class="op">;</span>
  <span class="kw">var</span> map <span class="op">=</span> <span class="kw">new</span> <span class="va">mapboxgl</span>.<span class="at">Map</span>(<span class="op">{</span>
    <span class="dt">container</span><span class="op">:</span> <span class="st">&#39;map&#39;</span><span class="op">,</span>
    <span class="dt">style</span><span class="op">:</span> <span class="st">&#39;mapbox://styles/mapbox/streets-v9&#39;</span>
  <span class="op">}</span>)<span class="op">;</span>
  <span class="va">map</span>.<span class="at">on</span>(<span class="st">&#39;load&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span>
    <span class="kw">var</span> geojsonData <span class="op">=</span> <span class="op">{</span>
      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;FeatureCollection&quot;</span><span class="op">,</span>
      <span class="st">&quot;features&quot;</span><span class="op">:</span> [<span class="op">{</span>
        <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Feature&quot;</span><span class="op">,</span>
        <span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">{</span>
          <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span>
          <span class="st">&quot;coordinates&quot;</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]
        <span class="op">}</span>
      <span class="op">}</span>]
    <span class="op">};</span>
    <span class="va">map</span>.<span class="at">addLayer</span>(<span class="op">{</span>
      <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;points&quot;</span><span class="op">,</span>
      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;circle&quot;</span><span class="op">,</span>
      <span class="st">&quot;source&quot;</span><span class="op">:</span> <span class="op">{</span>
        <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;geojson&quot;</span><span class="op">,</span>
        <span class="st">&quot;data&quot;</span><span class="op">:</span> geojsonData
      <span class="op">}</span>
    <span class="op">}</span>)
  <span class="op">}</span>)
  <span class="kw">&lt;/script&gt;</span>
  <span class="kw">&lt;p&gt;&lt;strong&gt;</span>School type:<span class="kw">&lt;/strong&gt;</span> {{ school.SCH_TYPE }}<span class="kw">&lt;/p&gt;</span>
  <span class="kw">&lt;p&gt;&lt;/p&gt;</span>
  <span class="kw">&lt;p&gt;&lt;/p&gt;</span>
<span class="kw">&lt;/div&gt;</span>
{% endblock %}</code></pre>
<p>Refresh the page and <strong>YOU HAVE A MAP!</strong></p>
<p><img src="images/04.png" /></p>
<p>A terrible, horrible map, with a circle in no meaningful position, but a map regardless. Let’s look at what each part of this new code does.</p>
<pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&#39;map&#39;</span><span class="ot"> style=</span><span class="st">&#39;width: 400px; height: 300px;&#39;</span><span class="kw">&gt;&lt;/div&gt;</span></code></pre>
<p>This code makes an empty box on your page. An <code>&lt;h1&gt;</code> is a headline and a <code>&lt;p&gt;</code> is a paragraph, but a <code>&lt;div&gt;</code> doesn’t really mean anything. This is going to be eventually filled up with your map. Right now it’s being set to 400 pixels wide and 300 pixels tall.</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">mapboxgl</span>.<span class="at">accessToken</span> <span class="op">=</span> <span class="st">&#39;pk.eyJ1IjoianNvbWEiLCJhIjoibFJmYl9JWSJ9.AUm8d76cbOvVEn2mMeG_ZA&#39;</span><span class="op">;</span>
<span class="kw">var</span> map <span class="op">=</span> <span class="kw">new</span> <span class="va">mapboxgl</span>.<span class="at">Map</span>(<span class="op">{</span>
  <span class="dt">container</span><span class="op">:</span> <span class="st">&#39;map&#39;</span><span class="op">,</span>
  <span class="dt">style</span><span class="op">:</span> <span class="st">&#39;mapbox://styles/mapbox/streets-v9&#39;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre>
<p>This is where we initialize MapBox GL.</p>
<p>In order to display the background of your map - called the <em>basemap</em>, you need to tell MapBox who you are (if you use a LOT of pageviews, they’ll start charging you). That’s what <code>mapboxgl.accessToken</code> is doing. We’re using the access token from their demo, so it shouldn’t be a problem.</p>
<p>The next few lines are setting up the map <code>&lt;div&gt;</code> that we made a little earlier, and telling MapBox what style we want the background map to be.</p>
<p>We then use <code>map.on('load')...</code> to wait for the map to load. Once it’s ready we start to assemble our data.</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> geojsonData <span class="op">=</span> <span class="op">{</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;FeatureCollection&quot;</span><span class="op">,</span>
  <span class="st">&quot;features&quot;</span><span class="op">:</span> [<span class="op">{</span>
    <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Feature&quot;</span><span class="op">,</span>
    <span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">{</span>
      <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span>
      <span class="st">&quot;coordinates&quot;</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]
    <span class="op">}</span>
  <span class="op">}</span>]
<span class="op">};</span></code></pre>
<p>MapBox GL uses a data format called <strong>GeoJSON</strong> to keep track of points, lines, shapes and such. You can play around with it at <a href="http://geojson.io/">geojson.io</a>, but the basic idea is that a single point or line or shape or watever is called a <strong>Feature</strong> and a bunch of features is called a <strong>FeatureCollection</strong>. In this case we have exactly one feature, and it’s a <code>Point</code> with coordinates at a latitude and longitude of <code>[0, 0]</code>.</p>
<p>Next up we need to actually give that data to our map so it can draw the point.</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">map</span>.<span class="at">addLayer</span>(<span class="op">{</span>
  <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;points&quot;</span><span class="op">,</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;circle&quot;</span><span class="op">,</span>
  <span class="st">&quot;source&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;geojson&quot;</span><span class="op">,</span>
    <span class="st">&quot;data&quot;</span><span class="op">:</span> geojsonData
  <span class="op">}</span>
<span class="op">}</span>)</code></pre>
<p>We’re using <code>addLayer</code> to attach our <code>geojsonData</code> to our map. You can tell all sorts of stuff to your map, from styling and interaction, but we’re just saying “hey, this is a bunch of circles, draw some circles.” Not very exciting, but it gets the job done.</p>
</div>
<div id="inserting-our-data-into-the-map" class="section level3">
<h3><span class="header-section-number">8.1.3</span> Inserting our data into the map</h3>
<p>The map is drawing a circle in the middle of the ocean because of these lines here:</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">{</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span>
  <span class="st">&quot;coordinates&quot;</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]
<span class="op">}</span></code></pre>
<p>The point says it’s at <code>[0, 0]</code>, and so the map draws it there. If we adjust the first number a little bit, we’ll see it jump to the right!</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">{</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span>
  <span class="st">&quot;coordinates&quot;</span><span class="op">:</span> [<span class="dv">30</span><span class="op">,</span> <span class="dv">0</span>]
<span class="op">}</span></code></pre>
<p>All we need to do is put the latitude and longitude of the school into those coordinates, and we’ll be all set! The confusing thing about this is that while this code is definitely JavaScript, <strong>we get to treat it just like HTML or anything else we’ve been using <code>{{ }}</code> with.</strong></p>
<p>Since our <code>school</code> has a <code>longitude</code> column and a <code>latitude</code> column, we can pop them right into the coordinates, and the circle will move right on along with them:</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">{</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span>
  <span class="st">&quot;coordinates&quot;</span><span class="op">:</span> [<span class="op">{{</span> <span class="va">school</span>.<span class="at">longitude</span> <span class="op">}},</span> <span class="op">{{</span> <span class="va">school</span>.<span class="at">latitude</span> <span class="op">}}</span>]
<span class="op">}</span></code></pre>
<p>If you view the source of the page, you can see how the longitude and latitude of your school just got dropped in.</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">{</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Point&quot;</span><span class="op">,</span>
  <span class="st">&quot;coordinates&quot;</span><span class="op">:</span> [<span class="op">-</span><span class="fl">73.95471</span><span class="op">,</span> <span class="fl">40.726437</span>]
<span class="op">}</span></code></pre>
<p>You didn’t have to do any JavaScript coding, you just said “hey, Jinja2 template, insert the Python variable’s coordinates exacty where I tell you.” It’s kind of weird to be using Python variables on an HTML page in a JavaScript section but hey, if it works it works!</p>
</div>
<div id="zooming-and-centering" class="section level3">
<h3><span class="header-section-number">8.1.4</span> Zooming and centering</h3>
<p>If we visited a few dozen of our school pages, we’d notice <em>they all seem to be in the same place</em>. That’s because we’re zoomed way out in the middle of nowhere!</p>
<p>Let’s start by centering our map on New York City. Its coordinates are roughly , so when we start up the map we can tell it exactly were to be. We’ll also zoom in a bit, just to frame the bounds of city nicely.</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">mapboxgl</span>.<span class="at">accessToken</span> <span class="op">=</span> <span class="st">&#39;pk.eyJ1IjoianNvbWEiLCJhIjoibFJmYl9JWSJ9.AUm8d76cbOvVEn2mMeG_ZA&#39;</span><span class="op">;</span>
<span class="kw">var</span> map <span class="op">=</span> <span class="kw">new</span> <span class="va">mapboxgl</span>.<span class="at">Map</span>(<span class="op">{</span>
  <span class="dt">container</span><span class="op">:</span> <span class="st">&#39;map&#39;</span><span class="op">,</span>
  <span class="dt">style</span><span class="op">:</span> <span class="st">&#39;mapbox://styles/mapbox/streets-v9&#39;</span><span class="op">,</span>
  <span class="dt">center</span><span class="op">:</span> [<span class="op">-</span><span class="dv">74</span><span class="op">,</span> <span class="fl">40.71</span>]<span class="op">,</span>
  <span class="dt">zoom</span><span class="op">:</span> <span class="dv">9</span>
<span class="op">}</span>)<span class="op">;</span></code></pre>
<p><img src="images/01.png" /></p>
<blockquote>
<p>Be sure to add a <code>,</code> at the end of the <code>style:</code> line, or JavaScript will get unhappy and break!</p>
</blockquote>
</div>
<div id="adjusting-the-style-of-our-dot" class="section level3">
<h3><span class="header-section-number">8.1.5</span> Adjusting the style of our dot</h3>
<p>Now that we’re zoomed in a bit I’m a little less happy with our black dot - it doesn’t stand out as well as I thought! If we want to play around with the style of the circle, we’ll do it by adding a <code>paint</code> option to our <code>addLayer</code> call:</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">map</span>.<span class="at">addLayer</span>(<span class="op">{</span>
  <span class="st">&quot;id&quot;</span><span class="op">:</span> <span class="st">&quot;points&quot;</span><span class="op">,</span>
  <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;circle&quot;</span><span class="op">,</span>
  <span class="st">&quot;source&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;geojson&quot;</span><span class="op">,</span>
    <span class="st">&quot;data&quot;</span><span class="op">:</span> geojsonData
  <span class="op">},</span>
  <span class="st">&quot;paint&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;circle-radius&quot;</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span>
    <span class="st">&quot;circle-color&quot;</span><span class="op">:</span> <span class="st">&quot;#ECCB2F&quot;</span><span class="op">,</span>
    <span class="st">&quot;circle-stroke-width&quot;</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>
    <span class="st">&quot;circle-stroke-color&quot;</span><span class="op">:</span> <span class="st">&quot;black&quot;</span>
  <span class="op">}</span>
<span class="op">}</span>)</code></pre>
<p>I set the circle radius to be a bit larger, gave it a fill color (using an <a href="https://htmlcolorcodes.com/">HTML color code</a>) and a little stroke (aka border) to make the circle stand out a bit more.</p>
<p>If we’re still not satisfied, we can play around with the style of the background - it’s easier to stand out if you’re on something lighter, right? To make this happen, you can <strong>adjust the initial map call</strong> to start with a different style.</p>
<pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">mapboxgl</span>.<span class="at">accessToken</span> <span class="op">=</span> <span class="st">&#39;pk.eyJ1IjoianNvbWEiLCJhIjoibFJmYl9JWSJ9.AUm8d76cbOvVEn2mMeG_ZA&#39;</span><span class="op">;</span>
<span class="kw">var</span> map <span class="op">=</span> <span class="kw">new</span> <span class="va">mapboxgl</span>.<span class="at">Map</span>(<span class="op">{</span>
  <span class="dt">container</span><span class="op">:</span> <span class="st">&#39;map&#39;</span><span class="op">,</span>
  <span class="dt">style</span><span class="op">:</span> <span class="st">&#39;mapbox://styles/mapbox/light-v10&#39;</span><span class="op">,</span>
  <span class="dt">center</span><span class="op">:</span> [<span class="op">-</span><span class="dv">74</span><span class="op">,</span> <span class="fl">40.71</span>]<span class="op">,</span>
  <span class="dt">zoom</span><span class="op">:</span> <span class="dv">9</span>
<span class="op">}</span>)<span class="op">;</span></code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="layouts-for-our-templates.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reorganizing-our-page-with-columns.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
